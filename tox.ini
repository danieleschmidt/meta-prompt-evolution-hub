[tox]
min_version = 4.0
env_list = 
    py{39,310,311,312}
    lint
    type
    security
    docs

[testenv]
deps = 
    pytest
    pytest-cov
    pytest-asyncio
    pytest-mock
    pytest-xdist
    pytest-benchmark
commands = 
    pytest {posargs:tests}

[testenv:lint]
deps = 
    black
    ruff
    isort
commands =
    black --check --diff .
    ruff check .
    isort --check-only --diff .

[testenv:format]
deps = 
    black
    ruff
    isort
commands =
    black .
    ruff check --fix .
    isort .

[testenv:type]
deps = 
    mypy
    types-redis
    types-requests
commands = 
    mypy meta_prompt_evolution tests

[testenv:security]
deps = 
    bandit[toml]
    safety
commands =
    bandit -r meta_prompt_evolution -f json -o bandit-report.json
    safety check --json --output safety-report.json

[testenv:docs]
deps = 
    sphinx
    sphinx-rtd-theme
    sphinx-autodoc-typehints
commands = 
    sphinx-build -W -b html docs docs/_build/html

[testenv:integration]
deps = 
    {[testenv]deps}
    docker-compose
commands = 
    pytest tests/integration {posargs}

[testenv:e2e]
deps = 
    {[testenv]deps}
    selenium
    pytest-playwright
commands = 
    pytest tests/e2e {posargs}

[testenv:performance]
deps = 
    {[testenv]deps}
    pytest-benchmark
    locust
commands = 
    pytest tests/performance {posargs}